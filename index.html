<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Top X% vs Everything Over X%</title>
<style>
  body {
    font-family: sans-serif;
    margin: 20px;
  }
  .container {
    display: flex;
    gap: 40px;
  }
  .panel {
    text-align: center;
  }
  svg {
    border: 1px solid #ccc;
    background: #fafafa;
  }
  .center {
    fill: steelblue;
  }
  .point {
    fill: black;
    cursor: pointer;
  }
  .point.in-range {
    fill: green;
  }
  .radius {
    fill: none;
    stroke: steelblue;
    stroke-dasharray: 5,5;
    stroke-width: 2;
  }
  .ring {
    fill: none;
    stroke: #ccc;
    stroke-dasharray: 2,4;
    stroke-width: 1;
  }
  .link {
    stroke: steelblue;
    stroke-width: 1.5;
  }
  .label {
    font-weight: bold;
    margin-bottom: 6px;
  }
</style>
</head>
<body>

<h2>Fishing Net vs Fishing line</h2>

<label>
  X (%):
  <input type="range" id="slider" min="0" max="100" value="0">
  <span id="xval">50</span>
</label>

<div class="container">
  <div class="panel">
    <div class="label">Net</div>
    <svg id="visA" width="400" height="400"></svg>
  </div>

  <div class="panel">
    <div class="label">Line</div>
    <svg id="visB" width="400" height="400"></svg>
  </div>
</div>

<script>
const width = 400;
const height = 400;
const center = { x: width / 2, y: height / 2 };
const maxRadius = 180;

let points = [];
let draggingPoint = null;

const slider = document.getElementById("slider");
const xval = document.getElementById("xval");

const svgA = document.getElementById("visA");
const svgB = document.getElementById("visB");

function distance(p) {
  return Math.hypot(p.x - center.x, p.y - center.y);
}

function render() {
  const x = +slider.value;
  xval.textContent = x;

  svgA.innerHTML = "";
  svgB.innerHTML = "";

  // --- LEFT: background rings every 10% ---
  for (let i = 10; i <= 100; i += 10) {
    const ring = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    ring.setAttribute("cx", center.x);
    ring.setAttribute("cy", center.y);
    ring.setAttribute("r", maxRadius * i / 100);
    ring.setAttribute("class", "ring");
    svgA.appendChild(ring);
  }

  // Centers
  [svgA, svgB].forEach(svg => {
    const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    c.setAttribute("cx", center.x);
    c.setAttribute("cy", center.y);
    c.setAttribute("r", 6);
    c.setAttribute("class", "center");
    svg.appendChild(c);
  });

  // --- LEFT: active radius ---
  const radius = (maxRadius * x) / 100;
  const radiusCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  radiusCircle.setAttribute("cx", center.x);
  radiusCircle.setAttribute("cy", center.y);
  radiusCircle.setAttribute("r", radius);
  radiusCircle.setAttribute("class", "radius");
  svgA.appendChild(radiusCircle);

  points.forEach(p => {
    const inRange = distance(p) <= radius;
    svgA.appendChild(makePointCircle(p, inRange));
  });

  // --- RIGHT: Top X% closest ---
  const sorted = [...points].sort((a, b) => distance(a) - distance(b));
  const count = Math.round(sorted.length * x / 100);
  const selected = new Set(sorted.slice(0, count));

  selected.forEach(p => {
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", center.x);
    line.setAttribute("y1", center.y);
    line.setAttribute("x2", p.x);
    line.setAttribute("y2", p.y);
    line.setAttribute("class", "link");
    svgB.appendChild(line);
  });

  points.forEach(p => {
    svgB.appendChild(makePointCircle(p, selected.has(p)));
  });
}

function makePointCircle(p, highlighted) {
  const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  c.setAttribute("cx", p.x);
  c.setAttribute("cy", p.y);
  c.setAttribute("r", 6);
  c.setAttribute("class", "point" + (highlighted ? " in-range" : ""));
  c.onmousedown = () => draggingPoint = p;
  return c;
}

function addPoint(evt) {
  const rect = evt.target.getBoundingClientRect();
  points.push({
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  });
  render();
}

[svgA, svgB].forEach(svg => {
  svg.addEventListener("click", addPoint);
});

document.addEventListener("mousemove", e => {
  if (!draggingPoint) return;
  const rect = svgA.getBoundingClientRect();
  draggingPoint.x = Math.max(0, Math.min(width, e.clientX - rect.left));
  draggingPoint.y = Math.max(0, Math.min(height, e.clientY - rect.top));
  render();
});

document.addEventListener("mouseup", () => draggingPoint = null);
slider.addEventListener("input", render);

render();
</script>

</body>
</html>
